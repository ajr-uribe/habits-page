<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento de HÃ¡bitos - Calendario</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 300;
        }

        .month-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .current-month {
            font-size: 1.5rem;
            font-weight: 500;
            min-width: 200px;
        }

        .habits-config {
            padding: 30px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .habits-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
        }

        .habits-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .habit-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 4px solid;
        }

        .habit-item:nth-child(1) { border-left-color: #10b981; }
        .habit-item:nth-child(2) { border-left-color: #3b82f6; }
        .habit-item:nth-child(3) { border-left-color: #f59e0b; }

        .habit-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .habit-input:focus {
            outline: none;
            border-color: #4facfe;
        }

        .calendar-container {
            padding: 30px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 1px;
            background: #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
        }

        .calendar-header {
            background: #374151;
            color: white;
            padding: 15px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .calendar-day {
            background: white;
            min-height: 120px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .day-number {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .habit-checks {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex-grow: 1;
        }

        .habit-check {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
        }

        .habit-checkbox {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            border: 2px solid #d1d5db;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            flex-shrink: 0;
        }

        .habit-checkbox.checked {
            background: #10b981;
            border-color: #10b981;
        }

        .habit-checkbox.checked::after {
            content: 'âœ“';
            position: absolute;
            top: -2px;
            left: 2px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .habit-checkbox:nth-child(1) { border-color: #10b981; }
        .habit-checkbox:nth-child(1).checked { background: #10b981; }

        .photo-section {
            margin-top: 8px;
            display: flex;
            gap: 4px;
            align-items: center;
            flex-wrap: wrap;
        }

        .photo-btn {
            background: #f3f4f6;
            border: 1px dashed #9ca3af;
            border-radius: 6px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .photo-btn:hover {
            background: #e5e7eb;
            border-color: #6b7280;
        }

        .photo-preview {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid #10b981;
        }

        .photo-input {
            display: none;
        }

        .stats {
            background: #f8fafc;
            padding: 20px 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4facfe;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            max-width: 90%;
            max-height: 90%;
            border-radius: 12px;
            position: relative;
        }

        .modal img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 12px;
        }

        .close-modal {
            position: absolute;
            top: -40px;
            right: 0;
            background: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .day-completion {
            margin-top: 5px;
            font-size: 0.7rem;
            color: #6b7280;
            text-align: center;
        }

        .photo-container {
            position: relative;
            display: inline-block;
        }

        .photo-container .photo-count-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            z-index: 10;
        }

        .photo-count-badge {
            background: #10b981;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 4px;
        }

        .photo-actions-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            justify-content: center;
            align-items: center;
        }

        .photo-actions-content {
            background: white;
            border-radius: 16px;
            padding: 25px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-height: 90vh;
            overflow-y: auto;
        }

        .photo-actions-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
        }

        .photo-actions-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .photo-action-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 500;
        }

        .photo-action-btn.primary {
            background: #4facfe;
            color: white;
        }

        .photo-action-btn.primary:hover {
            background: #3b8fd9;
            transform: translateY(-2px);
        }

        .photo-action-btn.secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .photo-action-btn.secondary:hover {
            background: #e5e7eb;
        }

        .photo-action-btn.danger {
            background: #fee2e2;
            color: #dc2626;
        }

        .photo-action-btn.danger:hover {
            background: #fecaca;
        }

        @media (max-width: 1024px) {
            .calendar-grid {
                font-size: 0.85rem;
            }
            
            .habits-list {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .current-month {
                font-size: 1.2rem;
                min-width: 150px;
            }

            .calendar-grid {
                grid-template-columns: repeat(8, 1fr);
                font-size: 0.75rem;
                gap: 2px;
            }
            
            .calendar-day {
                min-height: 80px;
                padding: 4px 2px;
            }

            .day-number {
                font-size: 0.8rem;
                margin-bottom: 4px;
            }
            
            .habit-check {
                font-size: 0.65rem;
                gap: 4px;
            }

            .habit-checkbox {
                width: 14px;
                height: 14px;
            }

            .habit-checkbox.checked::after {
                font-size: 10px;
                left: 1px;
            }
            
            .photo-btn, .photo-preview {
                width: 28px;
                height: 28px;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
                padding: 15px;
                gap: 15px;
            }

            .stat-number {
                font-size: 1.5rem;
            }

            .habits-config {
                padding: 20px 15px;
            }

            .calendar-container {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .current-month {
                font-size: 1rem;
                min-width: 120px;
            }

            .nav-btn {
                padding: 8px 12px;
                font-size: 1rem;
            }

            .calendar-grid {
                font-size: 0.7rem;
            }

            .calendar-day {
                min-height: 70px;
                padding: 3px 1px;
            }

            .day-number {
                font-size: 0.75rem;
            }

            .habit-check span {
                display: none;
            }

            .photo-btn, .photo-preview {
                width: 24px;
                height: 24px;
                font-size: 0.7rem;
            }

            .modal-content {
                max-width: 95%;
                max-height: 80%;
            }

            .photo-actions-content {
                max-width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“… Seguimiento de HÃ¡bitos</h1>
            <div class="month-nav">
                <button class="nav-btn" onclick="changeMonth(-1)">â€¹</button>
                <div class="current-month" id="currentMonth"></div>
                <button class="nav-btn" onclick="changeMonth(1)">â€º</button>
            </div>
        </div>

        <div class="habits-config">
            <div class="habits-title">Configura tus 3 hÃ¡bitos</div>
            <div class="habits-list">
                <div class="habit-item">
                    <input type="text" class="habit-input" id="habit1" placeholder="Ej: Ejercicio diario" value="Ejercicio diario">
                </div>
                <div class="habit-item">
                    <input type="text" class="habit-input" id="habit2" placeholder="Ej: Leer 30 minutos" value="Leer 30 minutos">
                </div>
                <div class="habit-item">
                    <input type="text" class="habit-input" id="habit3" placeholder="Ej: Meditar" value="Meditar">
                </div>
            </div>
        </div>

        <div class="calendar-container">
            <div class="calendar-grid" id="calendar">
                <!-- El calendario se genera dinÃ¡micamente -->
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalDays">0</div>
                <div class="stat-label">DÃ­as del mes</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedHabits">0</div>
                <div class="stat-label">HÃ¡bitos completados</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="successRate">0%</div>
                <div class="stat-label">Tasa de Ã©xito</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedDays">0</div>
                <div class="stat-label">DÃ­as con al menos un hÃ¡bito</div>
            </div>
        </div>
    </div>

    <div class="modal" id="photoModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">Ã—</button>
            <img id="modalImage" src="" alt="Evidencia">
        </div>
    </div>

    <div class="photo-actions-modal" id="photoActionsModal">
        <div class="photo-actions-content">
            <div class="photo-actions-title">Gestionar Evidencias</div>
            <div class="photo-actions-buttons" id="photoActionsButtons">
                <!-- Botones se generan dinÃ¡micamente -->
            </div>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let habitData = {};
        let photoData = {};
        let habitNames = {
            habit1: "Ejercicio diario",
            habit2: "Leer 30 minutos",
            habit3: "Meditar"
        };

        // Cargar datos desde memoria (en lugar de localStorage)
        let memoryStorage = {
            habitTrackerData: null,
            habitTrackerPhotos: null,
            habitTrackerNames: null
        };

        function loadData() {
            if (memoryStorage.habitTrackerData) {
                habitData = memoryStorage.habitTrackerData;
            }
            
            if (memoryStorage.habitTrackerPhotos) {
                photoData = memoryStorage.habitTrackerPhotos;
            }
            
            if (memoryStorage.habitTrackerNames) {
                habitNames = memoryStorage.habitTrackerNames;
                document.getElementById('habit1').value = habitNames.habit1;
                document.getElementById('habit2').value = habitNames.habit2;
                document.getElementById('habit3').value = habitNames.habit3;
            }
        }

        function saveData() {
            memoryStorage.habitTrackerData = JSON.parse(JSON.stringify(habitData));
            memoryStorage.habitTrackerPhotos = JSON.parse(JSON.stringify(photoData));
            memoryStorage.habitTrackerNames = JSON.parse(JSON.stringify(habitNames));
        }

        function updateMonthDisplay() {
            const months = [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
            ];
            document.getElementById('currentMonth').textContent = 
                `${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
        }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            updateMonthDisplay();
            generateCalendar();
            updateStats();
        }

        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';

            // Headers
            const headers = ['DÃ­a', habitNames.habit1, habitNames.habit2, habitNames.habit3, 'Evidencias'];
            headers.forEach(header => {
                const headerDiv = document.createElement('div');
                headerDiv.className = 'calendar-header';
                headerDiv.textContent = header;
                calendar.appendChild(headerDiv);
            });

            // DÃ­as del mes
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let day = 1; day <= daysInMonth; day++) {
                const dateKey = `${year}-${month + 1}-${day}`;

                // Columna del dÃ­a
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.innerHTML = `<div class="day-number">${day}</div>`;
                
                // AÃ±adir indicador de completado para el dÃ­a
                const completedCount = getCompletedHabitsCount(dateKey);
                if (completedCount > 0) {
                    const completionDiv = document.createElement('div');
                    completionDiv.className = 'day-completion';
                    completionDiv.textContent = `${completedCount}/3`;
                    dayDiv.appendChild(completionDiv);
                }
                
                calendar.appendChild(dayDiv);

                // Columnas de hÃ¡bitos
                for (let habit = 1; habit <= 3; habit++) {
                    const habitDiv = document.createElement('div');
                    habitDiv.className = 'calendar-day';
                    
                    const habitCheck = document.createElement('div');
                    habitCheck.className = 'habit-check';
                    
                    const checkbox = document.createElement('div');
                    checkbox.className = 'habit-checkbox';
                    if (habitData[dateKey] && habitData[dateKey][`habit${habit}`]) {
              checkbox.classList.add('checked');
                    }
                    checkbox.onclick = () => toggleHabit(dateKey, habit, checkbox);
                    
                    const habitLabel = document.createElement('span');
                    habitLabel.textContent = habitNames[`habit${habit}`];
                    
                    habitCheck.appendChild(checkbox);
                    habitCheck.appendChild(habitLabel);
                    habitDiv.appendChild(habitCheck);
                    calendar.appendChild(habitDiv);
                }

                // Columna de evidencias
                const photoDiv = document.createElement('div');
                photoDiv.className = 'calendar-day';
                
                const photoSection = document.createElement('div');
                photoSection.className = 'photo-section';
                
                // Mostrar contador de fotos si existen
                const photoCount = photoData[dateKey] ? photoData[dateKey].length : 0;
                
                if (photoCount > 0) {
                    // Mostrar miniatura de la primera foto
                    const photoContainer = document.createElement('div');
                    photoContainer.className = 'photo-container';
                    
                    const img = document.createElement('img');
                    img.className = 'photo-preview';
                    img.src = typeof photoData[dateKey][0] === 'string' ? photoData[dateKey][0] : photoData[dateKey][0].src;
                    img.onclick = () => showPhotoActions(dateKey);
                    img.title = 'Click para gestionar evidencias';
                    
                    photoContainer.appendChild(img);
                    
                    // Mostrar badge con cantidad si hay mÃ¡s de una foto
                    if (photoCount > 1) {
                        const badge = document.createElement('span');
                        badge.className = 'photo-count-badge';
                        badge.textContent = photoCount;
                        photoContainer.appendChild(badge);
                    }
                    
                    photoSection.appendChild(photoContainer);
                } else {
                    // BotÃ³n para agregar primera foto
                    const addBtn = document.createElement('div');
                    addBtn.className = 'photo-btn';
                    addBtn.innerHTML = 'ðŸ“·';
                    addBtn.title = 'Agregar evidencia';
                    addBtn.onclick = () => showPhotoActions(dateKey);
                    
                    photoSection.appendChild(addBtn);
                }
                
                photoDiv.appendChild(photoSection);
                calendar.appendChild(photoDiv);
            }
        }

        function getCompletedHabitsCount(dateKey) {
            if (!habitData[dateKey]) return 0;
            
            let count = 0;
            for (let i = 1; i <= 3; i++) {
                if (habitData[dateKey][`habit${i}`]) {
                    count++;
                }
            }
            return count;
        }

        function toggleHabit(dateKey, habitNumber, checkbox) {
            if (!habitData[dateKey]) {
                habitData[dateKey] = {};
            }
            
            const habitKey = `habit${habitNumber}`;
            habitData[dateKey][habitKey] = !habitData[dateKey][habitKey];
            
            if (habitData[dateKey][habitKey]) {
                checkbox.classList.add('checked');
            } else {
                checkbox.classList.remove('checked');
            }
            
            saveData();
            updateStats();
            generateCalendar();
        }

        function handlePhotoUpload(event, dateKey, replaceAll = false) {
            const files = event.target.files;
            if (files.length > 0) {
                if (replaceAll) {
                    photoData[dateKey] = [];
                } else {
                    if (!photoData[dateKey]) {
                        photoData[dateKey] = [];
                    }
                }
                
                Array.from(files).forEach(file => {
                    if (!file.type.startsWith('image/')) {
                        alert('Por favor, selecciona solo archivos de imagen');
                        return;
                    }
                    
                    if (file.size > 5 * 1024 * 1024) {
                        alert('La imagen es demasiado grande. MÃ¡ximo 5MB permitido.');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        photoData[dateKey].push({
                            src: e.target.result,
                            timestamp: new Date().toISOString(),
                            name: file.name
                        });
                        saveData();
                        generateCalendar();
                        
                        const action = replaceAll ? 'reemplazada' : 'agregada';
                        showNotification(`Evidencia ${action} correctamente`, 'success');
                    };
                    
                    reader.onerror = function() {
                        showNotification('Error al cargar la imagen', 'error');
                    };
                    
                    reader.readAsDataURL(file);
                });
                
                event.target.value = '';
            }
        }

        function showPhotoActions(dateKey) {
            const modal = document.getElementById('photoActionsModal');
            const buttonsContainer = document.getElementById('photoActionsButtons');
            buttonsContainer.innerHTML = '';
            
            const hasPhotos = photoData[dateKey] && photoData[dateKey].length > 0;
            
            if (hasPhotos) {
                const viewBtn = document.createElement('button');
                viewBtn.className = 'photo-action-btn primary';
                viewBtn.innerHTML = 'ðŸ‘ï¸ Ver Evidencias';
                viewBtn.onclick = () => {
                    closePhotoActions();
                    showPhotoGallery(dateKey);
                };
                buttonsContainer.appendChild(viewBtn);
                
                const addMoreBtn = document.createElement('button');
                addMoreBtn.className = 'photo-action-btn primary';
                addMoreBtn.innerHTML = 'âž• Agregar MÃ¡s';
                addMoreBtn.onclick = () => {
                    closePhotoActions();
                    triggerFileUpload(dateKey, false);
                };
                buttonsContainer.appendChild(addMoreBtn);
                
                const replaceBtn = document.createElement('button');
                replaceBtn.className = 'photo-action-btn secondary';
                replaceBtn.innerHTML = 'ðŸ”„ Reemplazar Todas';
                replaceBtn.onclick = () => {
                    if (confirm('Â¿EstÃ¡s seguro de que quieres reemplazar todas las evidencias?')) {
                        closePhotoActions();
                        triggerFileUpload(dateKey, true);
                    }
                };
                buttonsContainer.appendChild(replaceBtn);
                
                const deleteAllBtn = document.createElement('button');
                deleteAllBtn.className = 'photo-action-btn danger';
                deleteAllBtn.innerHTML = 'ðŸ—‘ï¸ Eliminar Todas';
                deleteAllBtn.onclick = () => {
                    if (confirm('Â¿EstÃ¡s seguro de que quieres eliminar todas las evidencias?')) {
                        delete photoData[dateKey];
                        saveData();
                        generateCalendar();
                        closePhotoActions();
                        showNotification('Evidencias eliminadas', 'info');
                    }
                };
                buttonsContainer.appendChild(deleteAllBtn);
            } else {
                const addBtn = document.createElement('button');
                addBtn.className = 'photo-action-btn primary';
                addBtn.innerHTML = 'ðŸ“· Agregar Evidencia';
                addBtn.onclick = () => {
                    closePhotoActions();
                    triggerFileUpload(dateKey, false);
                };
                buttonsContainer.appendChild(addBtn);
            }
            
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'photo-action-btn secondary';
            cancelBtn.innerHTML = 'âœ• Cancelar';
            cancelBtn.onclick = closePhotoActions;
            buttonsContainer.appendChild(cancelBtn);
            
            modal.style.display = 'flex';
        }

        function closePhotoActions() {
            document.getElementById('photoActionsModal').style.display = 'none';
        }

        function triggerFileUpload(dateKey, replaceAll) {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.multiple = true;
            fileInput.onchange = (e) => handlePhotoUpload(e, dateKey, replaceAll);
            fileInput.click();
        }

        function showPhotoGallery(dateKey) {
            const modal = document.getElementById('photoActionsModal');
            const buttonsContainer = document.getElementById('photoActionsButtons');
            buttonsContainer.innerHTML = '';
            
            const title = document.querySelector('.photo-actions-title');
            title.textContent = 'GalerÃ­a de Evidencias';
            
            const galleryContainer = document.createElement('div');
            galleryContainer.style.cssText = `
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 10px;
                margin-bottom: 20px;
                max-height: 400px;
                overflow-y: auto;
            `;
            
            photoData[dateKey].forEach((photo, index) => {
                const photoItem = document.createElement('div');
                photoItem.style.cssText = `
                    position: relative;
                    aspect-ratio: 1;
                    border-radius: 8px;
                    overflow: hidden;
                    cursor: pointer;
                `;
                
                const img = document.createElement('img');
                img.src = typeof photo === 'string' ? photo : photo.src;
                img.style.cssText = `
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                `;
                img.onclick = () => {
                    closePhotoActions();
                    openModal(typeof photo === 'string' ? photo : photo.src);
                };
                
                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = 'Ã—';
                deleteBtn.style.cssText = `
                    position: absolute;
                    top: 5px;
                    right: 5px;
                    background: #ef4444;
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 24px;
                    height: 24px;
                    cursor: pointer;
                    font-size: 16px;
                    font-weight: bold;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    if (confirm('Â¿Eliminar esta evidencia?')) {
                        photoData[dateKey].splice(index, 1);
                        if (photoData[dateKey].length === 0) {
                            delete photoData[dateKey];
                        }
                        saveData();
                        generateCalendar();
                        closePhotoActions();
                        showNotification('Evidencia eliminada', 'info');
                    }
                };
                
                photoItem.appendChild(img);
                photoItem.appendChild(deleteBtn);
                galleryContainer.appendChild(photoItem);
            });
            
            buttonsContainer.appendChild(galleryContainer);
            
            const backBtn = document.createElement('button');
            backBtn.className = 'photo-action-btn secondary';
            backBtn.innerHTML = 'â† Volver';
            backBtn.onclick = () => {
                title.textContent = 'Gestionar Evidencias';
                closePhotoActions();
                showPhotoActions(dateKey);
            };
            buttonsContainer.appendChild(backBtn);
            
            modal.style.display = 'flex';
        }

        function showNotification(message, type = 'info') {
            let notification = document.getElementById('notification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'notification';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    border-radius: 8px;
                    color: white;
                    font-weight: 500;
                    z-index: 10000;
                    transition: all 0.3s ease;
                    transform: translateX(100%);
                    opacity: 0;
                `;
                document.body.appendChild(notification);
            }
            
            const colors = {
                success: '#10b981',
                error: '#ef4444',
                info: '#3b82f6',
                warning: '#f59e0b'
            };
            
            notification.textContent = message;
            notification.style.backgroundColor = colors[type] || colors.info;
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
                notification.style.opacity = '1';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                notification.style.opacity = '0';
            }, 3000);
        }

        function openModal(imageSrc) {
            document.getElementById('modalImage').src = imageSrc;
            document.getElementById('photoModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('photoModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function exportData() {
            const data = {
                habitData,
                photoData,
                habitNames,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `habitos-${currentDate.getFullYear()}-${currentDate.getMonth() + 1}.json`;
            link.click();
            
            showNotification('Datos exportados correctamente', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.habitData && importedData.photoData && importedData.habitNames) {
                        if (confirm('Â¿EstÃ¡s seguro de que quieres importar estos datos? Se sobrescribirÃ¡n los datos actuales.')) {
                            habitData = importedData.habitData;
                            photoData = importedData.photoData;
                            habitNames = importedData.habitNames;
                            
                            document.getElementById('habit1').value = habitNames.habit1;
                            document.getElementById('habit2').value = habitNames.habit2;
                            document.getElementById('habit3').value = habitNames.habit3;
                            
                            saveData();
                            generateCalendar();
                            updateStats();
                            showNotification('Datos importados correctamente', 'success');
                        }
                    } else {
                        showNotification('Archivo invÃ¡lido', 'error');
                    }
                } catch (error) {
                    showNotification('Error al importar datos', 'error');
                    console.error('Error importing data:', error);
                }
            };
            
            reader.readAsText(file);
            event.target.value = '';
        }

        function clearMonthData() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            
            if (confirm(`Â¿EstÃ¡s seguro de que quieres limpiar todos los datos de ${getMonthName(month)} ${year}? Esta acciÃ³n no se puede deshacer.`)) {
                const prefix = `${year}-${month}-`;
                
                Object.keys(habitData).forEach(key => {
                    if (key.startsWith(prefix)) {
                        delete habitData[key];
                    }
                });
                
                Object.keys(photoData).forEach(key => {
                    if (key.startsWith(prefix)) {
                        delete photoData[key];
                    }
                });
                
                saveData();
                generateCalendar();
                updateStats();
                showNotification('Datos del mes limpiados', 'info');
            }
        }

        function getMonthName(month) {
            const months = [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
            ];
            return months[month - 1];
        }

        function updateStats() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            const daysInMonth = new Date(year, month, 0).getDate();
            
            let totalCompleted = 0;
            let totalPossible = daysInMonth * 3;
            let daysWithAtLeastOneHabit = 0;
            let perfectDays = 0;
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateKey = `${year}-${month}-${day}`;
                if (habitData[dateKey]) {
                    let dayCompleted = false;
                    let dayPerfect = true;
                    
                    for (let habit = 1; habit <= 3; habit++) {
                        if (habitData[dateKey][`habit${habit}`]) {
                            totalCompleted++;
                            dayCompleted = true;
                        } else {
                            dayPerfect = false;
                        }
                    }
                    
                   if (dayCompleted) {
                        daysWithAtLeastOneHabit++;
                    }
                    
                    if (dayPerfect) {
                        perfectDays++;
                    }
                }
            }
            
            document.getElementById('totalDays').textContent = daysInMonth;
            document.getElementById('completedHabits').textContent = totalCompleted;
            document.getElementById('completedDays').textContent = daysWithAtLeastOneHabit;
            
            const successRate = totalPossible > 0 ? Math.round((totalCompleted / totalPossible) * 100) : 0;
            document.getElementById('successRate').textContent = `${successRate}%`;
            
            const perfectDaysElement = document.getElementById('perfectDays');
            if (perfectDaysElement) {
                perfectDaysElement.textContent = perfectDays;
            }
        }

        function addUtilityButtons() {
            const header = document.querySelector('.header');
            
            const utilsContainer = document.createElement('div');
            utilsContainer.style.cssText = `
                display: flex;
                gap: 10px;
                justify-content: center;
                margin-top: 15px;
                flex-wrap: wrap;
            `;
            
            const exportBtn = document.createElement('button');
            exportBtn.textContent = 'ðŸ“¤ Exportar';
            exportBtn.onclick = exportData;
            
            const importBtn = document.createElement('button');
            importBtn.textContent = 'ðŸ“¥ Importar';
            importBtn.onclick = () => document.getElementById('importInput').click();
            
            const clearBtn = document.createElement('button');
            clearBtn.textContent = 'ðŸ—‘ï¸ Limpiar Mes';
            clearBtn.onclick = clearMonthData;
            
            const importInput = document.createElement('input');
            importInput.type = 'file';
            importInput.id = 'importInput';
            importInput.accept = '.json';
            importInput.style.display = 'none';
            importInput.onchange = importData;
            
            [exportBtn, importBtn, clearBtn].forEach(btn => {
                btn.style.cssText = `
                    background: rgba(255,255,255,0.2);
                    border: 1px solid rgba(255,255,255,0.3);
                    color: white;
                    padding: 8px 15px;
                    border-radius: 20px;
                    cursor: pointer;
                    font-size: 0.9rem;
                    transition: all 0.3s ease;
                `;
                btn.onmouseover = () => btn.style.background = 'rgba(255,255,255,0.3)';
                btn.onmouseout = () => btn.style.background = 'rgba(255,255,255,0.2)';
            });
            
            utilsContainer.appendChild(exportBtn);
            utilsContainer.appendChild(importBtn);
            utilsContainer.appendChild(clearBtn);
            header.appendChild(utilsContainer);
            document.body.appendChild(importInput);
        }

        function addPerfectDaysStat() {
            const stats = document.querySelector('.stats');
            
            const perfectDaysCard = document.createElement('div');
            perfectDaysCard.className = 'stat-card';
            perfectDaysCard.innerHTML = `
                <div class="stat-number" id="perfectDays">0</div>
                <div class="stat-label">DÃ­as perfectos (3/3)</div>
            `;
            
            stats.appendChild(perfectDaysCard);
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
                closePhotoActions();
            }
        });

        document.getElementById('photoModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        document.getElementById('photoActionsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePhotoActions();
            }
        });
        function initCalendar() {
            loadData();
            updateMonthDisplay();
            generateCalendar();
            updateStats();
            addUtilityButtons();
            addPerfectDaysStat();
            
            document.getElementById('habit1').addEventListener('input', function() {
                habitNames.habit1 = this.value;
                saveData();
                generateCalendar();
            });
            document.getElementById('habit2').addEventListener('input', function() {
                habitNames.habit2 = this.value;
                saveData();
                generateCalendar();
            });
            document.getElementById('habit3').addEventListener('input', function() {
                habitNames.habit3 = this.value;
                saveData();
                generateCalendar();
            });
        }

        initCalendar();
    </script>
</body>
</html>